---
import Layout from '~/layouts/PageLayout.astro';
import { Icon } from 'astro-icon/components';

import Hero from '~/components/widgets/Hero.astro';
import Note from '~/components/widgets/Note.astro';
import Features from '~/components/widgets/Features.astro';
import Features2 from '~/components/widgets/Features2.astro';
import Steps from '~/components/widgets/Steps.astro';
import Content from '~/components/widgets/Content.astro';
import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import Stats from '~/components/widgets/Stats.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';

import heroVideo from '~/assets/hero/hero.mp4';
import heroPoster from '~/assets/hero/hero.jpg';
import { SITE } from 'astrowind:config';

const metadata = {
  title: 'Velloc Browser — Your browser. Your rules.',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <Hero image={`<video autoplay loop muted playsinline class="mx-auto rounded-md w-full" poster="${heroPoster}" style="transform: scale(0.8);"><source src="${heroVideo}" type="video/mp4" /></video>`}>
    <Fragment slot="actions">
      <div style="transform: translateY(0px); opacity: 1; filter: blur(0px);">
        <a
          href={SITE?.download || '/download/install.exe'}
          class="transition-bg flex items-center justify-center gap-2 rounded-xl px-6 py-4 transition-transform duration-150 hover:scale-[1.02] active:scale-[0.98] w-fit border border-[var(--aw-color-text-default)] bg-[var(--aw-color-text-default)] text-[var(--aw-color-bg-page)] shadow-lg"
          data-astro-cid-vnzlvqnm=""
        >
          Download Velloc Browser Now
          <Icon name="tabler:download" class="w-5 h-5" />
        </a>
      </div>
    </Fragment>
    <Fragment slot="title">
      Your browser. Your rules.
    </Fragment>

    <Fragment slot="subtitle">
      Flexible layouts. Powerful blocking. User scripts.
      Control how the web looks and works.
      AI-powered controls, when you’re ready.
    </Fragment>
  </Hero>

  <!-- Interactive Features Section -->
  <section id="features" class="py-16 md:py-20">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="text-center mb-12">
        <p class="text-sm font-bold tracking-wide uppercase text-primary mb-2">Features</p>
        <h2 class="text-3xl md:text-4xl font-bold mb-4">Build your own browser.</h2>
        <p class="text-lg text-muted max-w-2xl mx-auto">Design your interface. Control the web. Work the way you think.</p>
      </div>

      <div class="flex flex-col md:flex-row gap-8 md:gap-12 items-start">
        <!-- Left: Feature items -->
        <div class="w-full md:w-2/5 flex flex-col gap-4">
          <button
            class="feature-item active group text-left w-full p-5 rounded-xl border-2 border-primary bg-primary/5 transition-all duration-300 cursor-pointer"
            data-feature="0"
          >
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full bg-primary text-white">
                <Icon name="tabler:components" class="w-5 h-5 md:w-6 md:h-6" />
              </div>
              <div>
                <h3 class="text-lg font-semibold mb-1">Shape the interface.</h3>
                <p class="text-sm text-muted">Vertical tabs. Compact mode. Classic Chrome UI. Built into the browser. Switch instantly.</p>
              </div>
            </div>
          </button>

          <button
            class="feature-item group text-left w-full p-5 rounded-xl border-2 border-transparent hover:border-primary/30 hover:bg-primary/5 transition-all duration-300 cursor-pointer"
            data-feature="1"
          >
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full bg-primary text-white">
                <Icon name="tabler:arrows-right-left" class="w-5 h-5 md:w-6 md:h-6" />
              </div>
              <div>
                <h3 class="text-lg font-semibold mb-1">Designed for focus</h3>
                <p class="text-sm text-muted">Split view. Background tab preview.</p>
                <p class="text-sm text-muted">Multitask without breaking flow.</p>
              </div>
            </div>
          </button>

          <button
            class="feature-item group text-left w-full p-5 rounded-xl border-2 border-transparent hover:border-primary/30 hover:bg-primary/5 transition-all duration-300 cursor-pointer"
            data-feature="2"
          >
            <div class="flex items-start gap-4">
              <div class="flex-shrink-0 w-10 h-10 md:w-12 md:h-12 flex items-center justify-center rounded-full bg-primary text-white">
                <Icon name="tabler:rocket" class="w-5 h-5 md:w-6 md:h-6" />
              </div>
              <div>
                <h3 class="text-lg font-semibold mb-1">Control the Web</h3>
                <p class="text-sm text-muted">Powerful blocking. Full userscript support.</p>
                <p class="text-sm text-muted"> MV2-compatible — no compromise on control.</p>
              </div>
            </div>
          </button>
        </div>

        <!-- Right: Image carousel / Video -->
        <div class="w-full md:w-3/5">
          <div class="relative rounded-xl overflow-hidden bg-gray-100 dark:bg-slate-800 aspect-video p-[10px]">
            <!-- Feature 0: Image Carousel -->
            <div class="feature-media active absolute inset-0" data-media="0">
              <div class="carousel relative w-full h-full">
                <img src="/images/layout-1.png" alt="Shape Interface 1" class="carousel-slide active absolute inset-0 w-full h-full object-contain transition-opacity duration-500 opacity-100" data-slide="0" />
                <img src="/images/layout-2.png" alt="Shape Interface 2" class="carousel-slide absolute inset-0 w-full h-full object-contain transition-opacity duration-500 opacity-0" data-slide="1" />
                <img src="/images/layout-3.png" alt="Shape Interface 3" class="carousel-slide absolute inset-0 w-full h-full object-contain transition-opacity duration-500 opacity-0" data-slide="2" />
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                  <span class="carousel-dot w-2 h-2 rounded-full bg-white/90 cursor-pointer" data-dot="0"></span>
                  <span class="carousel-dot w-2 h-2 rounded-full bg-white/40 cursor-pointer" data-dot="1"></span>
                  <span class="carousel-dot w-2 h-2 rounded-full bg-white/40 cursor-pointer" data-dot="2"></span>
                </div>
              </div>
            </div>

            <!-- Feature 1: Video -->
            <div class="feature-media hidden absolute inset-0 flex items-center justify-center bg-transparent" data-media="1">
              <video autoplay loop muted playsinline poster="/video/split-preview.jpg" class="w-full h-full object-contain">
                <source src="/video/split-preview.mp4" type="video/mp4" />
              </video>
            </div>

            <!-- Feature 2: Video placeholder -->
            <div class="feature-media hidden absolute inset-0 flex items-center justify-center bg-transparent" data-media="2">
              <video autoplay loop muted playsinline poster="" class="w-full h-full object-contain">
                <source src="/video/ad-blocker.mp4" type="video/mp4" />
              </video>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const featureItems = document.querySelectorAll('.feature-item');
      const featureMedias = document.querySelectorAll('.feature-media');
      const carouselIntervals: Record<string, ReturnType<typeof setInterval>> = {};

      function activateFeature(index: number) {
        featureItems.forEach((item) => {
          item.classList.remove('active', 'border-primary', 'bg-primary/5');
          item.classList.add('border-transparent');
        });
        const activeBtn = document.querySelector(`.feature-item[data-feature="${index}"]`);
        if (activeBtn) {
          activeBtn.classList.add('active', 'border-primary', 'bg-primary/5');
          activeBtn.classList.remove('border-transparent');
        }

        featureMedias.forEach((media) => {
          media.classList.add('hidden');
          media.classList.remove('active');
        });
        const activeMedia = document.querySelector(`.feature-media[data-media="${index}"]`);
        if (activeMedia) {
          activeMedia.classList.remove('hidden');
          activeMedia.classList.add('active');
        }

        Object.values(carouselIntervals).forEach(clearInterval);
        startCarousel(index);
      }

      function startCarousel(featureIndex: number) {
        const media = document.querySelector(`.feature-media[data-media="${featureIndex}"]`);
        if (!media) return;

        const slides = media.querySelectorAll('.carousel-slide');
        const dots = media.querySelectorAll('.carousel-dot');
        if (slides.length === 0) return;

        let currentSlide = 0;

        function showSlide(idx: number) {
          slides.forEach((s) => { (s as HTMLElement).style.opacity = '0'; s.classList.remove('active'); });
          dots.forEach((d) => { (d as HTMLElement).style.backgroundColor = 'rgba(255,255,255,0.4)'; });
          (slides[idx] as HTMLElement).style.opacity = '1';
          slides[idx].classList.add('active');
          if (dots[idx]) (dots[idx] as HTMLElement).style.backgroundColor = 'rgba(255,255,255,0.9)';
        }

        dots.forEach((dot, i) => {
          dot.addEventListener('click', () => {
            currentSlide = i;
            showSlide(currentSlide);
          });
        });

        carouselIntervals[String(featureIndex)] = setInterval(() => {
          currentSlide = (currentSlide + 1) % slides.length;
          showSlide(currentSlide);
        }, 3000);
      }

      featureItems.forEach((item) => {
        item.addEventListener('click', () => {
          const index = parseInt(item.getAttribute('data-feature') || '0');
          activateFeature(index);
        });
      });

      startCarousel(0);
    });
  </script>

</Layout>
